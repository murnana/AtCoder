# csharp-problem-solver エージェント

## 概要

`csharp-problem-solver` は、AtCoderの競技プログラミング問題をC#で実装する専門エージェントです。問題分析結果を基に、効率的で正確な解答コードを適切なC#ワークスペースの`Program.cs`に実装します。

## ⚠️ 重要: ワークスペース選択

**実装前に必ず以下を確認してください:**

1. **複数のC#環境が存在します**:
   - `workspaces/csharp-dotnet-9-0-8-aot/` - **現在推奨** - C# 13.0 (.NET 9.0.8 AOT) - 2025年11月1日（ABC430）から
   - `workspaces/csharp-dotnet-7-0-7-aot/` - **レガシー** - C# 11.0 (.NET 7.0.7 AOT) - 2025年10月31日まで

2. **各ワークスペースの`README.md`を確認**:
   - AtCoder環境のバージョン情報を確認
   - 現在のAtCoder設定と一致するワークスペースを選択
   - 特に指定がない場合は最新環境（`csharp-dotnet-9-0-8-aot`）を使用

3. **デフォルト動作**:
   - 明示的な指定がない限り、最新の`csharp-dotnet-9-0-8-aot`を使用

4. **参考リンク**:
   - [AtCoder言語アップデート告知](https://atcoder.jp/posts/1593)

## 目的

問題分析が完了した後、以下を実施します:

- 💻 **ソリューション実装**: `Program.cs`への効率的なC#コード作成
- 🧮 **アルゴリズム実装**: 制約に基づいた最適なアルゴリズム選択
- ⚡ **最適化**: 時間・メモリ制約内での動作保証
- 📚 **詳細なドキュメント**: 日本語による解法説明とコメント
- 🧪 **テスト実行**: サンプルケースでの動作検証

このエージェントは**実装とデバッグ**を担当し、問題分析は行いません。

## 使用方法

### 基本的な呼び出し

問題を実装したい場合、以下のように依頼します:

```
"この問題をC#で実装して"
```

```
"Program.csに解答を書いて"
```

### 前提条件

**推奨**: `atcoder-question-analyzer`エージェントが以下の3ファイルを生成済みであること:

```
workspaces/ai/claude/
├── problem-statement.md              # 問題文と制約
├── problem-statement-testcases.md    # サンプルテストケース
└── problem-statement-explanation.md  # 解法説明とアルゴリズム
```

これらのファイルがあれば、エージェントは分析結果を参照して効率的に実装できます。

**代替**: 分析ファイルがない場合でも、問題文を直接提供すれば独立して分析・実装可能です。

### 対話フロー

#### 1. 分析結果の読み込み

エージェントは`workspaces/ai/claude/`の3ファイルを読み取ります:
- 制約確認
- 推奨アルゴリズムの理解
- サンプルテストケースの把握
- C#実装ヒントの確認

#### 2. 実装戦略の確認

- 公式解説がある場合、その手法を優先
- 推奨されたアルゴリズムの選択
- データ構造の決定
- 計算量要件の確認

#### 3. コード実装

選択したワークスペースの`Murnana.AtCoder/Program.cs`（デフォルト: `workspaces/csharp-dotnet-9-0-8-aot/Murnana.AtCoder/Program.cs`）に以下を含む実装:

**XML ドキュメントコメント**:
```csharp
/// <summary>
/// AtCoder ABC350（〇〇〇〇）
/// C - Odd One Subsequence
/// 🤖 本プログラムはClaude Code (claude.ai/code) の支援により作成されました
/// </summary>
/// <remarks>
/// 解法のポイント:
/// - 度数法による組み合わせ計算
/// - 各値xについて「2個のx + 1個の非x」の組み合わせを計算
///
/// 【計算量】
/// - 時間計算量: O(N)
/// - 空間計算量: O(N)
///
/// 【実装の利点】
/// - O(N³)の全探索を回避
/// - 度数配列で効率的にカウント
/// </remarks>
/// <seealso href="https://atcoder.jp/contests/abc429/tasks/abc429_c" />
/// <seealso href="https://atcoder.jp/contests/abc429/editorial/14283" />
private static void Main()
{
    Expander.Expand();
    // 実装...
}
```

**コード本体**:
- 解法の核心を示すセクションコメント（日本語）
- ステップごとの詳細な説明コメント（日本語）
- 具体例を含む数式の説明
- 視覚的なセパレータで論理ブロックを区切り

#### 4. テスト実行

```bash
dotnet run --project Murnana.AtCoder
```

サンプル入力でテストし、出力を検証します。

#### 5. デバッグと修正

エラーやWA（Wrong Answer）が発生した場合:
- エッジケースの確認
- 型の見直し（int vs long）
- ロジックの再検証
- サンプル以外のケースのテスト

### 自動実行される処理

1. **分析ファイルの読み込み**
   - `workspaces/ai/claude/`から3つのMarkdownファイルを読み取り
   - 制約、アルゴリズム、実装ヒントを抽出

2. **実装戦略の決定**
   - 公式解説があればそれを優先
   - 計算量要件に基づくアルゴリズム選択
   - C#固有の最適化（fast I/O、データ型選択など）

3. **コードの生成**
   - `Program.cs`に完全な解答コードを記述
   - XML ドキュメントコメント（日本語）
   - インラインコメント（日本語、詳細な説明付き）

4. **ビルドとテスト**
   - `dotnet run`でコンパイル・実行
   - サンプルケースでの動作確認
   - 必要に応じてデバッグ

## ワークフロー詳細

### Phase 1: 分析結果の読み込み
```
📄 problem-statement.md を読み込み
   - 問題文と制約を確認
   ↓
📄 problem-statement-testcases.md を読み込み
   - サンプル入力/出力を把握
   ↓
📄 problem-statement-explanation.md を読み込み
   - 推奨アルゴリズムを確認
   - 計算量要件を確認
   - C#実装ヒントを確認
```

### Phase 2: 実装戦略の決定
```
🧮 アルゴリズムの選択
   - 公式解説があれば優先
   - 計算量要件を満たすか確認
   ↓
🗂️ データ構造の選択
   - 配列 vs List
   - Dictionary, Queue, Stack など
   - ac-library-csharpの利用可能性
   ↓
⚡ 最適化の検討
   - int vs long（オーバーフロー対策）
   - fast I/O の必要性
   - LINQ の使用可否（パフォーマンス）
```

### Phase 3: コード実装
```
📝 XML ドキュメントコメント作成
   - <summary>: 問題情報とAI支援表記
   - <remarks>: 解法ポイント、計算量、実装の利点
   - <seealso>: 問題URL、解説URL
   ↓
💻 Main メソッド実装
   - Expander.Expand() 呼び出し
   - 入力処理
   - ロジック実装（セクションコメント付き）
   - 出力処理
   ↓
📝 インラインコメント追加
   - 解法の核心部分に詳細説明
   - 具体例を含む数式の解説
   - 視覚的セパレータで論理区切り
```

### Phase 4: ビルドとテスト
```
🔨 dotnet run --project Murnana.AtCoder
   ↓
📊 サンプル入力でテスト
   ↓
   ┌─ 成功 ────────────────────────┐
   │  ✅ 出力が期待値と一致        │
   │     ↓                          │
   │  📝 完了報告                   │
   └───────────────────────────────┘
   ┌─ 失敗 ────────────────────────┐
   │  ❌ 出力が不一致 / エラー     │
   │     ↓                          │
   │  🐛 デバッグ開始               │
   └───────────────────────────────┘
```

### Phase 5: デバッグ（必要時）
```
🔍 エラー原因の特定
   - コンパイルエラー
   - 実行時エラー
   - 論理エラー（WA）
   ↓
🔧 修正実施
   - 型の変更（int → long）
   - ロジックの見直し
   - エッジケース対応
   ↓
🔄 再テスト
   - サンプルで確認
   - エッジケースで確認
```

## トラブルシューティング

### Q: 分析ファイルが見つからない

**A**: `workspaces/ai/claude/`に以下のファイルがあるか確認してください:
- `problem-statement.md`
- `problem-statement-testcases.md`
- `problem-statement-explanation.md`

ない場合:
1. `atcoder-question-analyzer`エージェントを先に実行
2. または問題文を直接提供して独立分析・実装
