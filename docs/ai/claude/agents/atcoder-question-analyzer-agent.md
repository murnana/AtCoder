# atcoder-question-analyzer エージェント

## 概要

`atcoder-question-analyzer` は、AtCoderの競技プログラミング問題を分析し、最適なアルゴリズムとソリューション戦略を提案する専門エージェントです。

## 目的

問題を実装する前に、以下の分析を実施します:

- 🔍 **問題理解**: 問題文を分解し、核心的な要求を特定
- 📊 **制約分析**: 時間・空間計算量の要件を算出
- 🧮 **アルゴリズム選択**: 制約に基づいた最適なアルゴリズムの推奨
- 📝 **公式解説取得**: AtCoderの公式解説を優先的に取得・分析
- 💡 **実装ガイダンス**: 実装ヒントと注意点の提供

このエージェントは**分析のみ**を担当し、コード実装は行いません。

## 使用方法

### 基本的な呼び出し

問題を分析したい場合、以下のように依頼します:

```
"ABC350のC問題を解析して"
```

```
"https://atcoder.jp/contests/abc429/tasks/abc429_c を分析して"
```

### 対話フロー

エージェントは以下のステップで動作します:

#### 1. 問題ページの取得
- WebFetchで問題文、制約、サンプルケースを取得
- AtCoder公式サイトから直接取得（日本語原文のまま）

#### 2. 公式解説の取得（フォールバック付き）

**Primary Method（2段階WebFetch）**:
```
Step 1: 解説インデックスページから editorial_id を抽出
Step 2: 個別解説ページから解説内容を取得
```

**Fallback 1（リポジトリ検索）**:
- `contests/{contest_id}/upsolving/` 内のファイルを検索
- 過去のupsolvingファイルのコメントから解説URLを抽出

**Fallback 2（ユーザー確認）**:
- WebFetchとリポジトリ検索が失敗した場合
- AskUserQuestionでユーザーに解説URLまたはIDを尋ねる
- ユーザーは以下のいずれかを選択可能:
  1. 解説URL提供（`https://atcoder.jp/contests/abc###/editorial/#####`）
  2. 解説ID提供（数字のみ）
  3. 解説なしで続行（`skip`）

**Fallback 3（独立分析）**:
- 解説が取得できない場合、制約とパターン認識に基づいた独自分析を実施

#### 3. 制約分析
- 計算量の許容範囲を算出
- O(N), O(N log N), O(N²) などの実行可能性を判定
- メモリ使用量の推定

#### 4. アルゴリズム推奨
- 問題パターンの認識（DP, グラフ理論, 貪欲法など）
- 適切なデータ構造の提案
- 複数のアプローチがある場合はトレードオフを説明

#### 5. 分析結果の出力

`workspaces/ai/claude/` ディレクトリに3つのMarkdownファイルを作成:

1. **`problem-statement.md`**: 問題文と基本情報
2. **`problem-statement-testcases.md`**: サンプルテストケース
3. **`problem-statement-explanation.md`**: 解法説明とアルゴリズム推奨

### 自動実行される処理

1. **問題ページのWebFetch**
   - URL: `https://atcoder.jp/contests/{contest_id}/tasks/{problem_id}`
   - 問題文、制約、サンプルケースを取得

2. **公式解説の取得（フォールバック戦略付き）**
   - Primary: 解説インデックスから自動抽出
   - Fallback 1: リポジトリ内の過去upsolvingファイルを検索
   - Fallback 2: ユーザーに解説URLを確認
   - Fallback 3: 解説なしで独立分析

3. **制約ベースのアルゴリズム分析**
   - 時間制限と入力サイズから計算量要件を算出
   - 実行可能なアルゴリズムクラスを特定

4. **3つの分析ファイルの生成**
   - 構造化された形式でMarkdownに出力
   - 次の実装エージェント（csharp-problem-solver）が利用可能な形式

## ワークフロー詳細

### Phase 1: 問題文取得
```
🌐 AtCoder問題ページにアクセス
   ↓
🔍 問題文（日本語原文）を抽出
   ↓
🔍 制約、入出力形式、サンプルケースを抽出
   ↓
📄 problem-statement.md に保存
```

### Phase 2: 公式解説取得（フォールバック付き）
```
🌐 解説インデックスページから editorial_id 抽出を試行
   ↓
   ┌─ 成功 ────────────────────────┐
   │  🌐 個別解説ページを取得      │
   │     ↓                          │
   │  📄 解説内容を保存             │
   └───────────────────────────────┘
   ┌─ 失敗 ────────────────────────┐
   │  🔍 リポジトリ内upsolving検索  │
   │     ↓                          │
   │  ┌─ 見つかった ──────────────┐│
   │  │ 📄 解説URLを抽出          ││
   │  │    ↓                      ││
   │  │ 🌐 解説ページを取得       ││
   │  └───────────────────────────┘│
   │  ┌─ 見つからない ────────────┐│
   │  │ ❓ ユーザーに解説URL確認  ││
   │  │    ↓                      ││
   │  │ ┌─ URL提供 ──────────────┐││
   │  │ │ 🌐 解説ページを取得    │││
   │  │ └────────────────────────┘││
   │  │ ┌─ skip選択 ─────────────┐││
   │  │ │ 📝 解説なしで続行      │││
   │  │ └────────────────────────┘││
   │  └───────────────────────────┘│
   └───────────────────────────────┘
```

### Phase 3: 制約分析
```
📊 時間制限・入力サイズの確認
   ↓
🧮 許容される操作数を算出
   ↓
⏱️ 実行可能な計算量クラスを判定
   (例: N≤10^5 → O(N log N)まで可能、O(N²)はTLE)
   ↓
💾 メモリ使用量の推定
```

### Phase 4: アルゴリズム推奨
```
🔍 問題パターンの認識
   ↓
🧩 適合するアルゴリズムの特定
   (DP, グラフ理論, 貪欲法, 数学的手法など)
   ↓
🗂️ 必要なデータ構造の提案
   (配列, priority queue, segment tree, Union-Find など)
   ↓
⚖️ 複数アプローチのトレードオフ分析
```

### Phase 5: 分析ファイル出力
```
📝 problem-statement.md 作成
   - 問題URL、難易度、制約
   - 問題文（日本語原文）
   - 入出力形式
   ↓
📝 problem-statement-testcases.md 作成
   - サンプル入力/出力
   - サンプル説明
   - エッジケース
   ↓
📝 problem-statement-explanation.md 作成
   - 制約分析
   - 推奨アルゴリズム
   - ソリューションステップ
   - 公式解説サマリー（取得できた場合）
```

## トラブルシューティング

### Q: 解説が取得できない

**A**: フォールバック戦略が自動的に動作します:
1. リポジトリ内の過去upsolving検索を試行
2. 見つからない場合、解説URLの入力を求められます
3. 解説インデックスページ（`https://atcoder.jp/contests/{contest_id}/editorial`）を開いて、該当問題の解説URLをコピーして提供してください
4. または "skip" と入力して解説なしで続行できます

### Q: 問題ページが取得できない

**A**: 以下を確認してください:
- 問題URLが正しいか（`https://atcoder.jp/contests/{contest_id}/tasks/{problem_id}`）
- コンテストIDと問題IDが一致しているか（例: `abc429` と `abc429_c`）
- AtCoder.jpにアクセス可能か

### Q: 分析ファイルが見つからない

**A**: `workspaces/ai/claude/` ディレクトリを確認してください:
- `problem-statement.md`
- `problem-statement-testcases.md`
- `problem-statement-explanation.md`

これらのファイルは `csharp-problem-solver` エージェントが実装時に参照します。
